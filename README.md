webaio
======

webaio provides a simple way to create async web applications based on aiottp.

Main Features
-------------

* class-bassed ViewSets and Routers to create RESTFul APIs
* APIException class to define and manage errors in an elegant way.
* Middlewares to catch and generate proper HttpResponses when an APIException is raised in the context of a endpoint.
* Scripts to create fully dockerized projects and apps with a set of tools to ease the development, documentation and deploy.



Installing
----------

Install using pip:

.. code-block:: text

    pip install webaio



Creating a project
--------------------
cd into a directory where you’d like to store your code, then run the following command:

.. code-block:: text

    $ webaio-create-project.py

a set of questions will be made in order to parametrize your project:

.. code-block:: text

    $ webaio-create-project.py 
    project_slug [webaio-project]: quickstart
    project_name [Webaio Project]: Quickstart
    description [A short description of the project]: A example project

This will create a quickstart directory in your current directory.

Let’s look at what  webaio-create-project.py created:


::

    quickstart/
    ├── apps
    │   └── __init__.py
    ├── conftest.py
    ├── docker-compose.yml
    ├── Dockerfile
    ├── .env
    ├── local.env
    ├── main.py
    ├── README.md
    ├── requirements.txt
    ├── routes.py
    └── settings.py


These files are:

* The outer quickstart/ root directory is a container for your project. Its name doesn’t matter to webaio; you can rename it to anything you like.
* The inner apps/ directory applications will be placed. We will create them in the future.
* quickstart/conftest.py: settings to run tests with pytest. We will write them later.
* quickstart/docker-compose.yml: a simple docker-compose file to run a container with the proyect.
* quickstart/Dockefile: a simple Dockerfile to create the container image.
* quickstart/.env: file to define enviroment variables. This will be used from docker-compose.
* quickstart/local.env: file to define enviroment variables. They will be available from the container and from the settings module.
* quickstart/main.py: module that instantiate and exposes an aiohttp app.
* quickstart/README.md: autogenerated readme with the proyect_name and description asked bellow.
* quickstart/requirements.txt: requirements used by the project template. You will add your own requirements here.
* quickstart/routes.py: module to define our project-level routes.
* quickstart/settings.py: module to define project-level settings. Environment variables will be accessible from here.


Develpment server
-----------------
Let’s verify if the project works. The project template works with Docker and docker-compose. You can find information about `Install docker <https://docs.docker.com/install/>`_ and `Install docker compose https://docs.docker.com/compose/install/>`_ in the official documentation.

In the project root directory run:

.. code-block:: text

    $ docker-compose.up

For the first time the docker image will be build. After that the deployment service will run. webaio uses `aiohttp-devtools https://github.com/aio-libs/aiohttp-devtools>`_  development server.

You will see an ouput like the following to indicate the project is running:

.. code-block:: text

    quickstart    | 01-31 14:03 adev.server.dft INFO     Starting aux server at http://0.0.0.0:8081 ◆
    quickstart    | [14:03:15] Starting aux server at http://0.0.0.0:8081 ◆
    quickstart    | [14:03:15] Starting dev server at http://0.0.0.0:8080 ●
    quickstart    | 01-31 14:03 adev.server.dft INFO     Starting dev server at http://0.0.0.0:8080 ●


You can enter to the swagger interface `http://localhost:8080/swagger http://localhost:8080/swagger>`_
We will explain how to register and document enpoints later.


Creating an application
-----------------------
Each application you write in webaio consists of a Python package that follows a certain convention. webaio comes with a utility that automatically generates the basic directory structure of an app, so you can focus on writing code rather than creating directories.

To create your app, make sure you’re in the root directory and type this command:

.. code-block:: text

    $ webaio-create-app.py 
    app_name [app]: api

That’ll create a directory api, which is laid out like this:

::

    api/
    ├── __init__.py
    ├── routes.py
    ├── tests
    │   ├── __init__.py
    │   └── test.py
    └── views.py

This directory structure will house the api application.


These files are:

* routes.py: this module exposes a list of route patters. As we will see later this routes can be generated by a router or manually.
* The inner tests/ directory will contain tests for the application.
* views.py: module to define function or class bassed views that can be registered in one or more routes.


